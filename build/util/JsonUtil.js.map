{"version":3,"sources":["../../src/util/JsonUtil.js"],"names":["ArrayWriter","stream","_stream","_cnt","write","arr","forEach","pre","JSON","stringify","data","Promise","resolve","end","JsonUtil","path","fs","existsSync","Error","_existPath","parse","readFileSync","e","is","createReadStream","dest","JSONStream","reduce","w","pipe","createWriteStream","readable","Readable","objectMode","read","push"],"mappings":";;;;;;;;AAAA;;;;AACA;;AACA;;;;AACA;;;;;;;;IAEMA,W;AACJ,uBAAYC,MAAZ,EAAoB;AAAA;;AAClB,SAAKC,OAAL,GAAeD,MAAf;AACA,SAAKE,IAAL,GAAY,CAAZ;AACA,SAAKD,OAAL,CAAaE,KAAb,CAAmB,GAAnB;AACD;;;;0BAEKC,G,EAAK;AAAA;;AACTA,UAAIC,OAAJ,CAAY,gBAAQ;AAClB,YAAMC,MAAM,MAAKJ,IAAL,KAAc,GAAd,GAAoB,EAAhC;AACA,cAAKD,OAAL,CAAaE,KAAb,CAAmBG,MAAMC,KAAKC,SAAL,CAAeC,IAAf,CAAN,GAA6B,IAAhD;AACD,OAHD;AAID;;;;;;;;;;;iDAGQ,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAa;AAC9B,yBAAKV,OAAL,CAAaE,KAAb,CAAmB,GAAnB;AACA,yBAAKF,OAAL,CAAaW,GAAb,CAAiB;AAAA,2BAAMD,SAAN;AAAA,mBAAjB;AACD,iBAHM,C;;;;;;;;;;;;;;;;;;;;;IASUE,Q;;;;;;;+BAEDC,I,EAAM;AACtB,UAAI,CAACC,aAAGC,UAAH,CAAcF,IAAd,CAAL,EAA0B;AACxB,cAAM,IAAIG,KAAJ,+BAAkBH,IAAlB,+HAAN;AACD;AACF;;;6BAEeA,I,EAAM;AACpB,WAAKI,UAAL,CAAgBJ,IAAhB;AACA,UAAI;AACF,eAAOP,KAAKY,KAAL,CAAWJ,aAAGK,YAAH,CAAgBN,IAAhB,EAAsB,OAAtB,CAAX,CAAP;AACD,OAFD,CAEE,OAAOO,CAAP,EAAU;AACV,cAAM,IAAIJ,KAAJ,+BAAkBH,IAAlB,wFAA6CO,CAA7C,CAAN;AACD;AACF;;;2CAE6BP,I,EAAe;AAC3C,WAAKI,UAAL,CAAgBJ,IAAhB;AACA,UAAMQ,KAAKP,aAAGQ,gBAAH,CAAoBT,IAApB,EAA0B,OAA1B,CAAX;;AAF2C,wCAANU,IAAM;AAANA,YAAM;AAAA;;AAG3C,aAAO,CAACC,qBAAWN,KAAX,CAAiB,GAAjB,CAAD,SAA2BK,IAA3B,EAAiCE,MAAjC,CAAwC,UAACJ,EAAD,EAAKK,CAAL;AAAA,eAAWL,GAAGM,IAAH,CAAQD,CAAR,CAAX;AAAA,OAAxC,EAA+DL,EAA/D,CAAP;AACD;;;4CAE8BR,I,EAAM;AACnC,aAAO,IAAIf,WAAJ,CAAgBgB,aAAGc,iBAAH,CAAqBf,IAArB,CAAhB,CAAP;AACD;;;6CAE+BV,G,EAAK;AACnC,UAAM0B,WAAW,IAAIC,gBAAJ,CAAa,EAAEC,YAAY,IAAd,EAAoBC,IAApB,kBAA2B,CAAE;AAA7B,OAAb,CAAjB;AACA7B,UAAIC,OAAJ,CAAY;AAAA,eAAKyB,SAASI,IAAT,CAAcb,CAAd,CAAL;AAAA,OAAZ;AACAS,eAASI,IAAT,CAAc,IAAd;AACA,aAAOJ,QAAP;AACD;;;;;;kBAhCkBjB,Q","file":"JsonUtil.js","sourcesContent":["import fs, { read } from 'fs';\nimport { Readable } from 'stream';\nimport JSONStream from 'JSONStream';\nimport { resolve } from 'path';\n\nclass ArrayWriter {\n  constructor(stream) {\n    this._stream = stream;\n    this._cnt = 0;\n    this._stream.write('[');\n  }\n\n  write(arr) {\n    arr.forEach(data => {\n      const pre = this._cnt++ ? ',' : '';\n      this._stream.write(pre + JSON.stringify(data) + '\\n');\n    });\n  }\n\n  async end() {\n    return new Promise((resolve) => {\n      this._stream.write(']');\n      this._stream.end(() => resolve());\n    });\n  }\n\n}\n\n\nexport default class JsonUtil {\n\n  static _existPath(path) {\n    if (!fs.existsSync(path)) {\n      throw new Error(`ファイル ${path} が存在しません。パスを確認してください。`);\n    }\n  }\n\n  static loadJson(path) {\n    this._existPath(path);\n    try {\n      return JSON.parse(fs.readFileSync(path, 'utf-8'));\n    } catch (e) {\n      throw new Error(`ファイル ${path} の JSON 読み込みに失敗しました ${e}`);\n    }\n  }\n\n  static toJSONArrayInputStream(path, ...dest) {\n    this._existPath(path);\n    const is = fs.createReadStream(path, 'utf-8');\n    return [JSONStream.parse('*'), ...dest].reduce((is, w) => is.pipe(w), is);\n  }\n\n  static createObjectArrayWriter(path) {\n    return new ArrayWriter(fs.createWriteStream(path));\n  }\n\n  static createObjectArrayReadble(arr) {\n    const readable = new Readable({ objectMode: true, read() {}});\n    arr.forEach(e => readable.push(e));\n    readable.push(null);\n    return readable;\n  }\n}\n"]}