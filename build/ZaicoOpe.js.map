{"version":3,"sources":["../src/ZaicoOpe.js"],"names":["ZaioOpeBase","config","options","context","orgData","requester","ZaicoRequester","filePath","path","isAbsolute","resolve","fileDir","cvtName","value","Converters","Error","type","cvt","argCvt","charAt","toLocaleUpperCase","substr","method","data","found","init","_","cloneDeep","initialValue","convert","newData","fromPairs","toPairs","Object","assign","map","key","mappingKey","replaceData","assignData","log","mapping","refData","get","forEach","k","v","Array","isArray","JSON","parse","reduce","cur","info","regexp","replace","newRep","m","p1","RegExp","stringify","cacheFile","JsonUtil","loadJson","cloneData","fs","writeFileSync","unlinkSync","out","createWriteStream","listToArrayWriter","createObjectArrayWriter","cache","jan","filter","z","find","findZaicoByKey","isEqual","files","length","existsSync","zaicoDataToCache","loadCacheData","useCache","isChangedData","dryrun","saveCacheData","removeCacheData","id","del","row","getRes","isEmpty","idx","findIndex","push","filePaths","canProcess","beforeFiles","_processFiles","afterFiles","f","_processFile","dirname","jangetterResult","title","rows","beforeRows","beforeRow","eachRow","afterRow","afterRows","fileToBase64","mimeType","mime","getType","body","readFileSync","VerifyOperation","msgs","list","listZaico","msg","join","AddOperation","force","findZaico","createRequestData","add","res","updateDatum","data_id","UpdateOperation","every","update","UpdateOrAddOperation","DeleteOperation","remove","CacheUpdateOperation","DeleteDuplicateOperation","janKey","jan2DataArr","o","val","removeJan","arr","undefined","created_at","updated_at","latest","oldest","slice","d","CacheFileOperationBase","zaicos","zaico","DiffUpdateOperation","keys","code","ignore","Set","diff","pickBy","has","verify","args","updateAdd","delete","deleteDuplicate","diffUpdate"],"mappings":"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","file":"ZaicoOpe.js","sourcesContent":["import fs from 'fs';\nimport path from 'path';\nimport _ from 'lodash';\nimport { forEachSeries } from 'p-iteration';\nimport mime from 'mime';\nimport JsonUtil from './util/JsonUtil'\nimport ZaicoRequester from './ZaicoRequester';\n\nclass ZaioOpeBase {\n  static Converters = {\n    fileToBase64: {\n      type: 'path',\n      // <img src=\"data:image/png;base64,xxxxx...\" />\n      cvt: (filePath) => {\n        const mimeType = mime.getType(filePath.replace(/^.*\\./, ''));\n        if (mimeType === 'application/octet-stream') throw new Error(`Couldn't get mime from ${filePath}`);\n        const body = fs.readFileSync(filePath, 'base64');\n        return `data:${mimeType};base64,${body}`;\n      },\n    }\n  };\n\n  constructor(config, options) {\n    this.config = config;\n    this.options = options;\n    this.context = {};\n    this.context.orgData = [];\n    this.requester = new ZaicoRequester(config, options);\n  }\n\n  _cvtArgPath(filePath) {\n    return path.isAbsolute(filePath) ? filePath : path.resolve(`${this.context.fileDir}/${filePath}`);\n  }\n\n  convert(cvtName, value) {\n    if (!cvtName) return value;\n    if (!ZaioOpeBase.Converters[cvtName]) throw new Error(`Converter ${cvtName} is not defined.`);\n    const { type, cvt } = ZaioOpeBase.Converters[cvtName];\n    const argCvt = `_cvtArg${type.charAt(0).toLocaleUpperCase()}${type.substr(1)}`;\n    if (typeof(this[argCvt]) !== 'function') throw new Error(`Converter arg processor ${argCvt} is not defined.`);\n    return cvt(this[argCvt](value));\n  }\n\n  createRequestData(method, data, found) {\n    const init = _.cloneDeep(this.config.initialValue[method] || {});\n    const convert = this.config.convert || {};\n    let newData = _.fromPairs(_.toPairs(Object.assign(init, data)).map(([key,value]) => [\n      this.mappingKey(key),\n      this.convert(convert[key], value),\n    ]));\n    newData = this.replaceData(method, newData, found);\n    newData = this.assignData(method, newData);\n    return newData;\n  }\n\n  log(...args) {\n    console.log(...args);\n  }\n\n  mappingKey(key) {\n    return this.config.mapping[key] || key;\n  }\n\n  replaceData(method, data, orgData) {\n    const refData = Object.assign({}, orgData || {}, data);\n    const replaceData = _.get(this.config, `replaceValue.${method}`);\n    if (replaceData) {\n      _.toPairs(replaceData).forEach(([k, v]) => {\n        if (!data[k] && refData[k] && Array.isArray(v)) {\n          data[k] = JSON.parse(v.reduce((cur, info) => {\n            if (Array.isArray(info.regexp) && typeof info.replace === 'string') {\n              const newRep = info.replace.replace(/\\$\\{(\\w+)\\}/g, (m, p1) => refData[p1] || '')\n              return cur.replace(new RegExp(...info.regexp), newRep);\n            }\n            return cur;\n          }, JSON.stringify(refData[k])));\n        }\n      });\n    }\n    return data;\n  }\n\n  assignData(method, data) {\n    const assignData = _.get(this.config, `assignValue.${method}`);\n    if (assignData) {\n      _.toPairs(assignData).forEach(([k, v]) => {\n        if (!data[k]) {\n          data[k] = JSON.parse(JSON.stringify(v).replace(/\\$\\{(\\w+)\\}/g, (m, p1) => data[p1] || ''));\n        }\n      })\n    }\n    return data;\n  }\n\n  loadCacheData() {\n    this.log('** read cahce', this.config.cacheFile);\n    this.context.data = JsonUtil.loadJson(this.config.cacheFile);\n    this.cloneData();\n  }\n\n  saveCacheData() {\n    this.log('** write cahce', this.config.cacheFile);\n    fs.writeFileSync(this.config.cacheFile, JSON.stringify(this.context.data, null, '  '), 'utf-8');\n    this.cloneData();\n  }\n\n  removeCacheData() {\n    this.log('** remove cahce', this.config.cacheFile);\n    fs.unlinkSync(this.config.cacheFile);\n  }\n\n  async zaicoDataToCache() {\n    this.log('** get all zaico data', this.config.cacheFile);\n    const out = fs.createWriteStream(this.config.cacheFile);\n    return await this.requester.listToArrayWriter(JsonUtil.createObjectArrayWriter(out));\n  }\n\n  useCache() {\n    return this.options.cache && this.config.cacheFile;\n  }\n\n  listZaico(jan) {\n    return this.context.data.filter(z => z[this.mappingKey('jan')] === jan);\n  }\n\n  findZaicoByKey(value, key) {\n    return this.context.data.find(z => z[key] === value);\n  }\n\n  findZaico(jan) {\n    return this.findZaicoByKey(jan, this.mappingKey('jan'));\n  }\n\n  cloneData() {\n    this.context.orgData = _.cloneDeep(this.context.data);\n  }\n\n  isChangedData() {\n    return !_.isEqual(this.context.data, this.context.orgData);\n  }\n\n  canProcess(files) {\n    return files.length > 0;\n  }\n\n  async beforeFiles() {\n    if (!fs.existsSync(this.config.cacheFile)) {\n      await this.zaicoDataToCache();\n    }\n    this.loadCacheData();\n  }\n\n  async afterFiles() {\n    if (this.useCache()) {\n      if (this.isChangedData() && !this.options.dryrun) {\n        this.saveCacheData();\n      }\n    } else {\n      this.removeCacheData();\n    }\n  }\n\n  async beforeRows() { }\n  async afterRows() { }\n  async beforeRow() { }\n  async afterRow() { }\n  async eachRow() { }\n\n  async updateDatum(id, del = false) {\n    if (this.useCache()) {\n      if (del) {\n        this.context.data = this.context.data.filter(row => row.id !== id);\n      } else {\n        const getRes = await this.requester.info(id);\n        if (!_.isEmpty(getRes)) {\n          const idx = this.context.data.findIndex(row => row.id === id);\n          if (idx >= 0) {\n            this.context.data[idx] = getRes.data;\n          } else {\n            this.context.data.push(getRes.data);\n          }\n        }\n      }\n    }\n  }\n\n  async processFiles(filePaths) {\n    if (!this.canProcess(filePaths)) {\n      return false;\n    }\n    await this.beforeFiles();\n    await this._processFiles(filePaths);\n    await this.afterFiles();\n    return true;\n  }\n\n  async _processFiles(filePaths) {\n    await forEachSeries(filePaths, async f => await this._processFile(f))\n  }\n\n  async _processFile(filePath) {\n    this.context.filePath = filePath; // 対象ファイル\n    this.context.fileDir = path.dirname(filePath); // 対象dir\n    const jangetterResult = JsonUtil.loadJson(filePath);\n    this.log('***', jangetterResult.title, '***');\n    const rows = jangetterResult.rows;\n    if (Array.isArray(rows)) {\n      await this.beforeRows(rows);\n      await forEachSeries(rows, async (row, idx) => {\n        await this.beforeRow(row);\n        this.log(`* [${idx+1}/${rows.length}]`, row.title);\n        await this.eachRow(row);\n        await this.afterRow(row);\n      });\n      await this.afterRows(rows);\n    } else {\n      this.log('*** rows is not array.');\n    }\n  }\n}\n\nclass VerifyOperation extends ZaioOpeBase {\n\n  async eachRow(row) {\n    const msgs = ['未登録', '登録済み', '**複数登録済み**'];\n    const list = this.listZaico(row.jan);\n    const msg = msgs[list.length > 1 ? 2 : list.length];\n    this.log(msg, list.map(row => row.jan).join(','));\n  }\n}\n\nclass AddOperation extends ZaioOpeBase {\n  async eachRow(row) {\n    if (!this.options.force && this.findZaico(row.jan)) {\n      this.log('すでにJANが登録されています', row.jan, row.title);\n      return;\n    }\n    const data = this.createRequestData('add', row);\n    const res = await this.requester.add(data);\n    if (!_.isEmpty(res)) await this.updateDatum(res.data.data_id);\n  }\n}\n\nclass UpdateOperation extends ZaioOpeBase {\n  async eachRow(row) {\n    const found = this.findZaico(row.jan);\n    if (found) {\n      const data = this.createRequestData('update', row, found);\n      if (this.options.force || !_.toPairs(data).every(([k, v]) => _.isEqual(v, found[k]))) {\n        const res = await this.requester.update(found.id, data);\n        if (!_.isEmpty(res)) await this.updateDatum(found.id);\n      }\n    } else {\n      this.log('未登録のため更新できません', row.jan, row.title);\n    }\n  }\n}\n\nclass UpdateOrAddOperation extends ZaioOpeBase {\n  async eachRow(row) {\n    const found = this.findZaico(row.jan);\n    if (found) {\n      const data = this.createRequestData('update', row, found);\n      if (this.options.force || !_.toPairs(data).every(([k, v]) => _.isEqual(v, found[k]))) {\n        const res = await this.requester.update(found.id, data);\n        if (!_.isEmpty(res)) await this.updateDatum(found.id);\n      }\n    } else {\n      const data = this.createRequestData('add', row);\n      const res = await this.requester.add(data);\n      if (!_.isEmpty(res)) await this.updateDatum(res.data.data_id);\n    }\n  }\n}\n\nclass DeleteOperation extends ZaioOpeBase {\n  async eachRow(row) {\n    const found = this.findZaico(row.jan);\n    if (found) {\n      const res = await this.requester.remove(found.id, row.jan);\n      if (!_.isEmpty(res)) await this.updateDatum(found.id, true);\n    } else {\n      this.log('未登録のため削除できません', row.jan, row.title);\n    }\n  }\n}\n\nclass CacheUpdateOperation extends ZaioOpeBase {\n  async beforeFiles() {\n    await this.zaicoDataToCache();\n  }\n\n  async _processFiles() {}\n\n  useCache() {\n    return true;\n  }\n\n  isChangedData() {\n    return false;\n  }\n\n  canProcess() {\n    return true;\n  }\n}\n\n/**\n * JANの重複を削除します。\n * - JANが重複していること\n * - 更新日時、作成日時が同じであること\n */\nclass DeleteDuplicateOperation extends ZaioOpeBase {\n\n  canProcess() {\n    return true;\n  }\n\n  async _processFiles() {\n    const janKey = this.mappingKey('jan');\n    const jan2DataArr = this.context.data.reduce((o, val) => {\n      (o[val[janKey]] || (o[val[janKey]] = [])).push(val);\n      return o;\n    }, {})\n    const removeJan = _.toPairs(jan2DataArr).map(([jan, arr]) => {\n      if (arr.length === 1) return undefined;\n      const data = arr.filter(v => v.created_at === v.updated_at);\n      if (data.length === arr.length) {\n        const { latest, oldest, force } = this.options;\n        if (latest) return ({ jan, data: data.slice(0, data.length - 1) });\n        if (oldest) return ({ jan, data: data.slice(1, data.length) });\n        if (!force) {\n          this.log(`重複したJANの全てが作成日・修正日が同じです[${jan}]`, ...arr.map(v => v.id));\n          return undefined;\n        }\n      } else if (data.length - arr.length > 1) {\n        const res = arr.filter(v => v.created_at !== v.updated_at);\n        this.log(`重複したJANに作成日・修正日が違うものが複数含まれます。キャッシュを更新し、verifyで確認してくださ[${jan}]`, ...res.map(v => v.id));\n      }\n      return ({ jan, data });\n    }).filter(v => v !== undefined);\n    await forEachSeries(removeJan, async ({jan, data}) => {\n      await forEachSeries(data, async d => {\n        const res = await this.requester.remove(d.id, jan);\n        if (!_.isEmpty(res)) await this.updateDatum(d.id, true);\n      });\n    });\n  }\n}\n\nclass CacheFileOperationBase extends ZaioOpeBase {\n\n  async _processFile(filePath) {\n    this.context.filePath = filePath; // 対象ファイル\n    this.context.fileDir = path.dirname(filePath); // 対象dir\n    const zaicos = JsonUtil.loadJson(filePath);\n    this.log('*** cacheファイル操作 ***');\n    if (Array.isArray(zaicos)) {\n      await this.beforeRows(zaicos);\n      await forEachSeries(zaicos, async (zaico, idx) => {\n        await this.beforeRow(zaico);\n        this.log(`* [${idx+1}/${zaicos.length}]`, zaico.title);\n        await this.eachRow(zaico);\n        await this.afterRow(zaico);\n      });\n      await this.afterRows(zaicos);\n    } else {\n      this.log(`*** ${filePath} is not array.`);\n    }\n  }\n}\n\nclass DiffUpdateOperation extends CacheFileOperationBase {\n  async eachRow(zaico) {\n    const found = this.findZaicoByKey(zaico.id, 'id');\n    if (found) {\n      if (Object.keys(zaico).length === 1) { // 削除\n        const res = await this.requester.remove(found.id, found.code);\n        if (!_.isEmpty(res)) await this.updateDatum(found.id, true);\n      } else { // 更新\n        // 差分をとって除外キーになってなくて違いがあるデータを残す\n        const ignore = new Set(_.get(this.config, 'ignoreKeys.diffUpdate', []));\n        const diff = _.pickBy(zaico, (v, k) => k in found && !ignore.has(k) && !_.isEqual(v, found[k]));\n        if (!_.isEmpty(diff)) {\n          this.log('diff', JSON.stringify(diff));\n          const res = await this.requester.update(found.id, diff);\n          if (!_.isEmpty(res)) await this.updateDatum(found.id);\n        }\n      }\n    } else {\n      this.log(`ID[${zaico.id}のデータが未登録のため更新できません`, zaico.jan, zaico.title);\n    }\n  }\n}\n\nexport default {\n  verify: (...args) => new VerifyOperation(...args),\n  add: (...args) => new AddOperation(...args),\n  update: (...args) => new UpdateOperation(...args),\n  updateAdd: (...args) => new UpdateOrAddOperation(...args),\n  delete: (...args) => new DeleteOperation(...args),\n  deleteDuplicate: (...args) => new DeleteDuplicateOperation(...args),\n  cache: (...args) => new CacheUpdateOperation(...args),\n  diffUpdate: (...args) => new DiffUpdateOperation(...args),\n}\n"]}