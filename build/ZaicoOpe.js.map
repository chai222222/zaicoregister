{"version":3,"sources":["../src/ZaicoOpe.js"],"names":["ZaioOpeBase","config","options","context","orgData","filePath","path","isAbsolute","resolve","fileDir","cvtName","value","Converters","Error","type","cvt","argCvt","charAt","toLocaleUpperCase","substr","method","data","init","initialValue","convert","_","fromPairs","toPairs","Object","assign","map","key","mappingKey","Authorization","token","log","err","response","console","status","statusText","headers","request","message","stack","mapping","cacheFile","JsonUtil","loadJson","cloneData","fs","writeFileSync","JSON","stringify","createRequestHeaders","nextUrl","apiUrl","allData","axios","get","catch","e","res","undefined","Array","isArray","push","link","m","exec","cache","jan","filter","z","find","cloneDeep","files","length","useCache","existsSync","loadCacheData","getZaicoData","list","saveCacheData","isChangedData","id","del","row","getRes","idx","findIndex","filePaths","canProcess","beforeFiles","f","processFile","afterFiles","dirname","jangetterResult","title","rows","beforeRows","beforeRow","eachRow","afterRow","afterRows","fileToBase64","mimeType","mime","getType","replace","body","readFileSync","VerifyOperation","msgs","listZaico","msg","join","AddOperation","createRequestData","post","data_id","updateDatum","UpdateOperation","found","findZaico","put","UpdateOrAddOperation","DeleteOperation","delete","CacheUpdateOperation","verify","args","add","update","updateAdd"],"mappings":"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","file":"ZaicoOpe.js","sourcesContent":["import axios from 'axios';\nimport fs from 'fs';\nimport path from 'path';\nimport _ from 'lodash';\nimport { forEachSeries } from 'p-iteration';\nimport mime from 'mime';\nimport JsonUtil from './util/JsonUtil'\n\nclass ZaioOpeBase {\n  static Converters = {\n    fileToBase64: {\n      type: 'path',\n      // <img src=\"data:image/png;base64,xxxxx...\" />\n      cvt: (filePath) => {\n        const mimeType = mime.getType(filePath.replace(/^.*\\./, ''));\n        if (mimeType === 'application/octet-stream') throw new Error(`Couldn't get mime from ${filePath}`);\n        const body = fs.readFileSync(filePath, 'base64');\n        return `data:${mimeType};base64,${body}`;\n      },\n    }\n  };\n\n  constructor(config, options) {\n    this.config = config;\n    this.options = options;\n    this.context = {};\n    this.context.orgData = [];\n  }\n\n  _cvtArgPath(filePath) {\n    return path.isAbsolute(filePath) ? filePath : path.resolve(`${this.context.fileDir}/${filePath}`);\n  }\n\n  convert(cvtName, value) {\n    if (!cvtName) return value;\n    if (!ZaioOpeBase.Converters[cvtName]) throw new Error(`Converter ${cvtName} is not defined.`);\n    const { type, cvt } = ZaioOpeBase.Converters[cvtName];\n    const argCvt = `_cvtArg${type.charAt(0).toLocaleUpperCase()}${type.substr(1)}`;\n    if (typeof(this[argCvt]) !== 'function') throw new Error(`Converter arg processor ${argCvt} is not defined.`);\n    return cvt(this[argCvt](value));\n  }\n\n  createRequestData(method, data) {\n    const init = this.config.initialValue[method] || {};\n    const convert = this.config.convert || {};\n    return _.fromPairs(_.toPairs(Object.assign(init, data)).map(([key,value]) => [\n      this.mappingKey(key),\n      this.convert(convert[key], value),\n    ]));\n  }\n\n  createRequestHeaders() {\n    return {\n      Authorization: `Bearer ${this.config.token}`,\n      'Content-Type': 'application/json',\n      'Accept': 'application/json',\n    };\n  }\n\n  log(...args) {\n    console.log(...args);\n  }\n\n  err(err) {\n    if (err.response) {\n      // The request was made and the server responded with a status code\n      // that falls out of the range of 2xx\n      console.log(err.response.data);\n      console.log(err.response.status);      // 例：400\n      console.log(err.response.statusText);  // Bad Request\n      console.log(err.response.headers);\n    } else if (err.request) {\n      // The request was made but no response was received\n      // `err.request` is an instance of XMLHttpRequest in the browser and an instance of\n      // http.ClientRequest in node.js\n      console.log(err.request);\n    } else {\n      // Something happened in setting up the request that triggered an Error\n      console.log('Error', err.message);\n    }\n    console.log(err.config);\n    if(err.stack) console.log(err.stack);\n  }\n\n  mappingKey(key) {\n    return this.config.mapping[key] || key;\n  }\n\n  loadCacheData() {\n    this.log('** read cahce', this.config.cacheFile);\n    this.context.data = JsonUtil.loadJson(this.config.cacheFile);\n    this.cloneData();\n  }\n\n  saveCacheData() {\n    this.log('** write cahce', this.config.cacheFile);\n    fs.writeFileSync(this.config.cacheFile, JSON.stringify(this.context.data, null, '  '), 'utf-8');\n    this.cloneData();\n  }\n\n  async getZaicoData() {\n    this.log('** get list', this.config.cacheFile);\n    const headers = this.createRequestHeaders();\n    let nextUrl = `${this.config.apiUrl}?page=1`; // 先頭ページからアクセス\n    const allData = [];\n    while (nextUrl) {\n      this.log('** get list', nextUrl);\n      const res = await axios.get(nextUrl, { headers }).catch((e) => this.err(e));\n      nextUrl = undefined;\n      if (res && Array.isArray(res.data)) {\n        allData.push(...res.data);\n        const link = res.headers.link;\n        let m;\n        if (link && (m = /<([^>]+)>; *rel=\"next\"/.exec(link))) {\n          nextUrl = m[1];\n        }\n      }\n    }\n    return allData;\n  }\n\n  useCache() {\n    return this.options.cache && this.config.cacheFile;\n  }\n\n  listZaico(jan) {\n    return this.context.data.filter(z => z[this.mappingKey('jan')] === jan);\n  }\n\n  findZaico(jan) {\n    return this.context.data.find(z => z[this.mappingKey('jan')] === jan);\n  }\n\n  cloneData() {\n    this.context.orgData = _.cloneDeep(this.context.data);\n  }\n\n  isChangedData() {\n    return JSON.stringify(this.context.data) !== JSON.stringify(this.context.orgData);\n  }\n\n  canProcess(files) {\n    return files.length > 0;\n  }\n\n  async beforeFiles() {\n    if (this.useCache()) {\n      if (fs.existsSync(this.config.cacheFile)) {\n        this.loadCacheData();\n        return;\n      }\n    }\n    this.context.data = [];\n    const list = await this.getZaicoData();\n    if (list) {\n      this.context.data = list;\n      if (this.useCache()) {\n        this.saveCacheData();\n      }\n    }\n  }\n\n  async afterFiles() {\n    if (this.useCache() && this.isChangedData()) {\n      this.saveCacheData();\n    }\n  }\n\n  async beforeRows() { }\n  async afterRows() { }\n  async beforeRow() { }\n  async afterRow() { }\n  async eachRow() { }\n\n  async updateDatum(id, del = false) {\n    if (this.useCache()) {\n      if (del) {\n        this.context.data = this.context.data.filter(row => row.id !== id);\n      } else {\n        const headers = this.createRequestHeaders();\n        const getRes = await axios.get(`${this.config.apiUrl}/${id}`, { headers }).catch((e) => this.err(e));\n        if (getRes) {\n          const idx = this.context.data.findIndex(row => row.id === id);\n          if (idx >= 0) {\n            this.context.data[idx] = getRes.data;\n          } else {\n            this.context.data.push(getRes.data);\n          }\n        }\n      }\n    }\n  }\n\n  async processFiles(filePaths) {\n    if (!this.canProcess(filePaths)) {\n      return false;\n    }\n    await this.beforeFiles();\n    await forEachSeries(filePaths, async f => await this.processFile(f))\n    await this.afterFiles();\n    return true;\n  }\n\n  async processFile(filePath) {\n    this.context.filePath = filePath; // 対象ファイル\n    this.context.fileDir = path.dirname(filePath); // 対象dir\n    const jangetterResult = JsonUtil.loadJson(filePath);\n    this.log('***', jangetterResult.title, '***');\n    const rows = jangetterResult.rows;\n    if (Array.isArray(rows)) {\n      await this.beforeRows(rows);\n      await forEachSeries(rows, async row => {\n        await this.beforeRow(row);\n        this.log('*', row.title);\n        await this.eachRow(row);\n        await this.afterRow(row);\n      });\n      await this.afterRows(rows);\n    } else {\n      this.log('*** rows is not array.');\n    }\n  }\n}\n\nclass VerifyOperation extends ZaioOpeBase {\n\n  async eachRow(row) {\n    const msgs = ['未登録', '登録済み', '**複数登録済み**'];\n    const list = this.listZaico(row.jan);\n    const msg = msgs[list.length > 1 ? 2 : list.length];\n    this.log(msg, list.map(row => row.jan).join(','));\n  }\n}\n\nclass AddOperation extends ZaioOpeBase {\n  async eachRow(row) {\n    const headers = this.createRequestHeaders();\n    const data = this.createRequestData('add', row);\n    // this.log(row,data);\n    const res = await axios.post(this.config.apiUrl, data, { headers }).catch((e) => this.err(e));\n    this.log('追加', row.jan, res.data.data_id);\n    if (res) await this.updateDatum(res.data.data_id);\n  }\n}\n\nclass UpdateOperation extends ZaioOpeBase {\n  async eachRow(row) {\n    const found = this.findZaico(row.jan);\n    if (found) {\n      const headers = this.createRequestHeaders();\n      const data = this.createRequestData('update', row);\n      const res = await axios.put(`${this.config.apiUrl}/${found.id}`, data, { headers }).catch((e) => this.err(e));\n      this.log('更新', row.jan, found.id);\n      if (res) await this.updateDatum(found.id);\n    } else {\n      this.log('未登録のため更新できません', row.jan, row.title);\n    }\n  }\n}\n\nclass UpdateOrAddOperation extends ZaioOpeBase {\n  async eachRow(row) {\n    const found = this.findZaico(row.jan);\n    const headers = this.createRequestHeaders();\n    if (found) {\n      const data = this.createRequestData('update', row);\n      const res = await axios.put(`${this.config.apiUrl}/${found.id}`, data, { headers }).catch((e) => this.err(e));\n      this.log('更新', row.jan, found.id);\n      if (res) await this.updateDatum(found.id);\n    } else {\n      const data = this.createRequestData('add', row);\n      const res = await axios.post(this.config.apiUrl, data, { headers }).catch((e) => this.err(e));\n      this.log('追加', row.jan, res.data.data_id);\n      if (res) await this.updateDatum(res.data.data_id);\n    }\n  }\n}\n\nclass DeleteOperation extends ZaioOpeBase {\n  async eachRow(row) {\n    const found = this.findZaico(row.jan);\n    if (found) {\n      const headers = this.createRequestHeaders();\n      const res = await axios.delete(`${this.config.apiUrl}/${found.id}`, { headers }).catch((e) => this.err(e));\n      this.log('削除', row.jan, found.id);\n      if (res) await this.updateDatum(found.id, true);\n    } else {\n      this.log('未登録のため削除できません', row.jan, row.title);\n    }\n  }\n}\n\nclass CacheUpdateOperation extends ZaioOpeBase {\n  async beforeFiles() {\n    const list = await this.getZaicoData();\n    if (list) this.context.data = list;\n  }\n\n  async processFile() {}\n\n  useCache() {\n    return true;\n  }\n\n  isChangedData() {\n    return true;\n  }\n\n  canProcess() {\n    return true;\n  }\n}\n\nexport default {\n  verify: (...args) => new VerifyOperation(...args),\n  add: (...args) => new AddOperation(...args),\n  update: (...args) => new UpdateOperation(...args),\n  updateAdd: (...args) => new UpdateOrAddOperation(...args),\n  delete: (...args) => new DeleteOperation(...args),\n  cache: (...args) => new CacheUpdateOperation(...args),\n}\n"]}